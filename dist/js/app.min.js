"use strict";const ERROR_SERVER="Ошибка сервера, попробуйте позже!",NO_PRODUCTS_IN_THIS_CATEGORY="Товаров в этой категории нет!",PRODUCT_INFORMATION_NOT_FOUND="Информация о товаре не найдена!";function showErrorMessage(t){const e=`<div class="error">\n            <p>${t}</p>\n            <p><a href="/">Перейти к списку товаров!</a></p>\n        </div>`;document.querySelector(".products__title").insertAdjacentHTML("afterend",e)}function getBasketLocalStorage(){const t=localStorage.getItem("basket");return t?JSON.parse(t):[]}function setBasketLocalStorage(t){const e=document.querySelector(".basket__counter");localStorage.setItem("basket",JSON.stringify(t)),e.textContent=t.length}function checkingRelevanceValueBasket(t){const e=getBasketLocalStorage();e.forEach(((o,n)=>{t.some((t=>t.id===Number(o)))||e.splice(n,1)})),setBasketLocalStorage(e)}const products=document.querySelector(".products__items");let productsData1=[];async function getProducts1(){try{if(!productsData1.length){const t=await fetch("../files/data.json");if(!t.ok)throw new Error(t.statusText);productsData1=await t.json()}renderStartPage(productsData1),filterShowBurgers(),filter()}catch(t){showErrorMessage(ERROR_SERVER),console.log(t.message)}}function renderStartPage(t){if(!t||!t.length)return void showErrorMessage(NO_PRODUCTS_IN_THIS_CATEGORY);createCards(t),checkingRelevanceValueBasket(t);checkingActiveButtons(getBasketLocalStorage())}function handleCardClick(t){const e=t.target.closest("[data-basket]");if(!e)return;const o=e.closest(".products__item").dataset.productId,n=getBasketLocalStorage();n.includes(o)||(n.push(o),setBasketLocalStorage(n),loadProductBasket(productsData1),hiddenOnOff(),productCounterBasket(),calcTotalPriceOrder(),checkingActiveButtons(n))}function checkingActiveButtons(t){document.querySelectorAll("[data-basket]").forEach((e=>{const o=e.closest(".products__item").dataset.productId,n=t.includes(o);e.disabled=n,e.classList.toggle("active",n),e.textContent=n?"Добавлено":"Добавить"}))}function createCards(t){t.forEach((t=>{const{id:e,img:o,title:n,price:c,weight:a,category:r}=t,d=`\n                <div class="products__item" data-product-id="${e}" data-category="${r}">\n                    <a href="#" data-modal="#add">\n                        <img class="img products__img" src="img/products/${o}" alt="${r}" data-img-id="${e}">\n                    </a>\n                    <div class="products__price">${c}</div>\n                    <div class="products__name">${n}</div>\n                    <div class="products__weight">${a}</div>\n                    <button class="btn" type="button" data-basket="order">Добавить</button>\n                </div>\n            `;products.insertAdjacentHTML("beforeend",d)}))}function filterShowBurgers(){document.querySelectorAll("[data-category]").forEach((t=>{"burger"!=t.getAttribute("data-category")&&t.classList.add("hidden")}))}function filter(){const t=document.querySelectorAll("[data-filter]");t.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();let o=e.getAttribute("data-filter");document.querySelectorAll("[data-category]").forEach((t=>{t.getAttribute("data-category")===o?t.classList.remove("hidden"):t.classList.add("hidden")})),document.querySelectorAll("[data-title]").forEach((t=>{t.getAttribute("data-title")===o?t.classList.remove("hidden"):t.classList.add("hidden")}))})),e.addEventListener("click",(()=>{t.forEach((t=>t.classList.remove("active"))),e.classList.add("active")}))}))}getProducts1(),products.addEventListener("click",handleCardClick);const order=document.querySelector(".order"),orderTop=order.querySelector(".order__top");let productsData2=[];async function getProducts2(){try{if(!productsData2.length){const t=await fetch("../files/data.json");if(!t.ok)throw new Error(t.statusText);productsData2=await t.json()}loadProductBasket(productsData2),hiddenOnOff(),productCounterBasket(),calcTotalPriceOrder()}catch(t){showErrorMessage(ERROR_SERVER),console.log(t.message)}}function loadProductBasket(t){if(!t||!t.length)return void showErrorMessage(ERROR_SERVER);checkingRelevanceValueBasket(t);const e=getBasketLocalStorage();orderTop.textContent="";const o=t.filter((t=>e.includes(String(t.id))));o.length&&renderProductsBasket(o)}function renderProductsBasket(t){t.forEach((t=>{const{id:e,img:o,title:n,price:c,weight:a}=t,r=`\n            <div class="order__product d-flex justify-content-between align-items-center" data-product-id="${e}">\n                <div class="d-flex">\n                    <img class="order__img" src="img/products/${o}" alt="order">\n                    <div>\n                        <div class="order__name">${n}</div>\n                        <div class="order__weight">${a}</div>\n                        <div class="order__price">${c}</div>\n                    </div>\n                </div>\n                <div class="counter d-flex justify-content-between align-items-center" data-counter-id="${e}">\n                    <button class="counter__minus" type="button">-</button>\n                    <div class="counter__result">1</div>\n                    <button class="counter__plus" type="button">+</button>\n                </div>\n            </div>\n            `;orderTop.insertAdjacentHTML("beforeend",r)}))}getProducts2();const collapse=document.querySelector(".btn--collapse"),expand=document.querySelector(".btn--expand");function visibilityToggle(){order.classList.contains("hidden")?expand.classList.remove("visibility"):expand.classList.add("visibility")}visibilityToggle(),collapse.addEventListener("click",(()=>{order.classList.add("hidden"),visibilityToggle()})),expand.addEventListener("click",(()=>{order.classList.remove("hidden"),visibilityToggle()}));const radio1=document.getElementById("radio1"),radio2=document.getElementById("radio2"),element=document.querySelector(".form__radio-checked");function productCounterBasket(){document.querySelectorAll(".counter").forEach((t=>{let e=0;getBasketLocalStorage().forEach((o=>{o==t.dataset.counterId&&(e++,t.querySelector(".counter__result").textContent=e)})),t.querySelector(".counter__plus").addEventListener("click",(()=>{e++,t.querySelector(".counter__result").textContent=e;const o=t.closest(".order__product").dataset.productId,n=getBasketLocalStorage();n.push(o),setBasketLocalStorage(n),calcTotalPriceOrder()})),t.querySelector(".counter__minus").addEventListener("click",(()=>{e--,t.querySelector(".counter__result").textContent=e;const o=t.closest(".order__product").dataset.productId,n=getBasketLocalStorage();if(n.splice(n.indexOf(o),1),setBasketLocalStorage(n),calcTotalPriceOrder(),e<1){setBasketLocalStorage(n.filter((t=>t!==o))),loadProductBasket(productsData2),hiddenOnOff(),productCounterBasket(),checkingActiveButtons(getBasketLocalStorage())}}))}))}function calcTotalPriceOrder(){const t=document.querySelectorAll(".counter"),e=document.querySelector(".order__sum");let o=0;t.forEach((t=>{const n=t.closest(".order__product"),c=n.querySelector(".order__price"),a=n.querySelector(".counter__result");let r=parseInt(c.textContent)*a.textContent;o+=r,e.textContent=o+"₴",freeDelivery()}))}function freeDelivery(){const t=document.querySelector(".order__delivery"),e=document.querySelector(".order__sum");parseInt(e.textContent)>=300?t.classList.remove("visibility"):t.classList.add("visibility")}function hiddenOnOff(){const t=document.querySelector(".basket__text"),e=document.querySelectorAll(".order__product"),o=document.querySelector(".order__bottom");e.length?(o.classList.remove("hidden"),t.classList.add("visibility")):(o.classList.add("hidden"),t.classList.remove("visibility"))}radio1.addEventListener("click",(()=>{element.classList.add("visibility")})),radio2.addEventListener("click",(()=>{element.classList.remove("visibility")}));const modalAdd=document.getElementById("add");let productsData3=[];async function getProducts3(){try{if(!productsData3.length){const t=await fetch("../files/data.json");if(!t.ok)throw new Error(t.statusText);productsData3=await t.json()}loadProductDetails(productsData3),modal()}catch(t){showErrorMessage(ERROR_SERVER),console.log(t.message)}}function loadProductDetails(t){t&&t.length?(checkingRelevanceValueBasket(t),document.addEventListener("click",(e=>{if(e.target.dataset.imgId){if(!e.target.dataset.imgId)return void showErrorMessage(PRODUCT_INFORMATION_NOT_FOUND);modalAdd.textContent="";const o=t.find((t=>t.id==e.target.dataset.imgId));if(!o)return void showErrorMessage(PRODUCT_INFORMATION_NOT_FOUND);renderInfoProduct(o),modal(),productCounterInModal(),addProductFromModalToBasket(),calcSubtotalPriceProduct(),checkingActiveButtonInModal()}}))):showErrorMessage(ERROR_SERVER)}function renderInfoProduct(t){const{id:e,img:o,title:n,price:c,weight:a,ccal:r,cp1:d,cp2:s,cp3:l,cp4:i,cp5:u,descr:m}=t,_=`\n        <div class="modal__dialog  modal__dialog--height">\n            <button class="btn  btn--close" type="button" data-close="#add">\n                <img src="img/modal/close.svg" alt="close">\n            </button>\n\n            <div class="modal-inner">\n                <h2 class="modal-inner__title">\n                    ${n}\n                </h2>\n\n                <div class="modal-inner__direction">\n                    <div class="modal-inner__left">\n                        <img class="img modal-inner__photo" src="img/products/${o}" alt="product">\n                    </div>\n\n                    <div class="modal-inner__right">\n                        <div class="modal-inner__text">\n                            ${m}\n                        </div>\n                        <ul class="modal-inner__list">\n                            <li class="modal-inner__item">\n                                Состав:\n                            </li>\n                            <li class="modal-inner__item">\n                                ${d}\n                            </li>\n                            <li class="modal-inner__item">\n                                ${s}\n                            </li>\n                            <li class="modal-inner__item">\n                                ${l}\n                            </li>\n                            <li class="modal-inner__item">\n                                ${i}\n                            </li>\n                            <li class="modal-inner__item">\n                                ${u}\n                            </li>\n                            <li class="modal-inner__item">\n                                ${a}, ккал ${r}\n                            </li>\n                        </ul>\n                    </div> \x3c!-- /.modal-inner__right --\x3e\n                </div> \x3c!-- /.modal-inner__direction --\x3e\n\n                <div class="d-flex flex-wrap mt-auto">\n                    <button class="btn btn--orange btn--modal" type="button" data-modal-add="addto" data-modal-button-id="${e}">Добавить</button>\n                    <div class="modal-counter d-flex justify-content-between align-items-center" data-modal-counter-id="${e}">\n                        <button class="modal-counter__minus" type="button">-</button>\n                        <div class="modal-counter__result">1</div>\n                        <button class="modal-counter__plus" type="button">+</button>\n                    </div>\n                    <div class="modal-inner__price d-flex align-items-center">\n                        ${c}\n                    </div>\n                </div>\n            </div>\n        </div>\n        `;modalAdd.insertAdjacentHTML("beforeend",_)}function productCounterInModal(){const t=document.querySelector(".modal-counter"),e=document.querySelector(".modal-counter__plus"),o=document.querySelector(".modal-counter__minus"),n=document.querySelector(".modal-counter__result"),c=getBasketLocalStorage();let a=0;c.forEach((e=>{e==t.dataset.modalCounterId&&(a++,n.textContent=a)}));let r=1;e.addEventListener("click",(()=>{r++,n.textContent=r})),o.addEventListener("click",(()=>{r>1&&r--,n.textContent=r}))}function calcSubtotalPriceProduct(){const t=document.querySelector(".modal-counter__result"),e=document.querySelector(".modal-inner__price");let o=t.textContent*parseInt(e.textContent);e.textContent=o+"₴"}function addProductFromModalToBasket(){const t=modalAdd.querySelector("[data-modal-add]"),e=document.querySelector(".modal-counter"),o=document.querySelector(".modal-counter__result");t.addEventListener("click",(()=>{const t=e.dataset.modalCounterId,n=o.textContent,c=getBasketLocalStorage();if(!c.includes(t)){for(let e=1;e<=n;e++)c.push(t),setBasketLocalStorage(c);loadProductBasket(productsData3),hiddenOnOff(),productCounterBasket(),calcTotalPriceOrder(),calcSubtotalPriceProduct(),checkingActiveButtons(getBasketLocalStorage()),checkingActiveButtonInModal()}}))}function checkingActiveButtonInModal(){const t=document.querySelector(".modal-counter"),e=modalAdd.querySelector("[data-modal-add]"),o=document.querySelector(".modal-counter__plus"),n=document.querySelector(".modal-counter__minus"),c=t.dataset.modalCounterId,a=getBasketLocalStorage().includes(c);e.disabled=a,o.disabled=a,n.disabled=a,e.classList.toggle("active--modal",a),e.textContent=a?"Добавлено":"Добавить"}function modal(){const t=document.body,e=document.querySelectorAll(".modal"),o=document.querySelectorAll(".modal__dialog"),n=document.querySelectorAll("[data-modal]"),c=document.querySelectorAll("[data-close]"),a=modalAdd.querySelectorAll("[data-modal-add]");n.forEach((e=>e.addEventListener("click",(o=>{o.preventDefault();let n=e.getAttribute("data-modal");document.querySelector(n).classList.remove("hidden"),t.classList.add("no-scroll")})))),c.forEach((e=>e.addEventListener("click",(()=>{let o=e.getAttribute("data-close");document.querySelector(o).classList.add("hidden"),t.classList.remove("no-scroll")})))),document.addEventListener("keydown",(o=>{"Escape"===o.key&&(e.forEach((t=>t.classList.add("hidden"))),t.classList.remove("no-scroll"))})),e.forEach((e=>e.addEventListener("click",(()=>{e.classList.add("hidden"),t.classList.remove("no-scroll")})))),o.forEach((t=>t.addEventListener("click",(t=>{t.stopPropagation()})))),a.forEach((e=>e.addEventListener("click",(()=>{setTimeout((()=>{modalAdd.classList.add("hidden"),t.classList.remove("no-scroll")}),500)}))))}getProducts3();